<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MedAI Question Bank - Fluency Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Roboto', system-ui, sans-serif;
      background-color: #f8fafc;
      font-size: 0.95rem;
      line-height: 1.6;
      color: #0f172a;
    }
    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-slate-900 text-slate-50 border-b border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">MedAI Question Bank</h1>
        <p class="text-sm md:text-base text-slate-300 mt-1">
          Build your AI fluency using structured question practice across five core domains.
        </p>
      </div>
      <a
        href="index.html"
        class="hidden md:inline-flex px-3 py-1.5 rounded-full bg-slate-700 text-slate-200 text-xs hover:bg-slate-600"
      >
        Back to Lexicon
      </a>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-1">
    <div class="max-w-6xl mx-auto px-4 py-6 grid gap-6 md:grid-cols-[1.2fr_1.8fr]">

      <!-- LEFT COLUMN -->
      <section class="bg-white border border-slate-200 rounded-2xl shadow-sm p-5 flex flex-col gap-4">

        <h2 class="text-lg md:text-xl font-semibold text-slate-900">
          Choose a domain and answer questions
        </h2>
        <p class="text-xs text-slate-600 -mt-2">
          Each domain pulls from your 200-item MedAI question bank. Aim for 8–10 questions per domain.
        </p>

        <!-- DOMAIN BUTTONS -->
        <div id="domainButtons" class="flex flex-wrap gap-2 text-xs md:text-sm"></div>

        <!-- QUESTION CARD -->
        <div class="border border-slate-200 bg-slate-50 rounded-2xl p-4 flex flex-col flex-1">
          <div class="flex justify-between items-center text-xs text-slate-500 mb-2">
            <span id="questionDomainLabel" class="font-medium text-indigo-700"></span>
            <span id="questionCounter"></span>
          </div>

          <div id="questionStem" class="text-sm md:text-base font-medium text-slate-900 mb-4"></div>

          <div id="optionsContainer" class="space-y-2 mb-4"></div>

          <div id="feedbackArea" class="text-xs md:text-sm"></div>

          <div class="flex justify-between mt-4">
            <button
              id="prevQuestionBtn"
              class="px-3 py-1.5 text-xs border border-slate-300 rounded-full text-slate-700 hover:bg-slate-100 disabled:opacity-40"
            >
              Previous
            </button>
            <button
              id="nextQuestionBtn"
              class="px-4 py-1.5 text-xs rounded-full bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-40"
            >
              Next question
            </button>
          </div>
        </div>

      </section>

      <!-- RIGHT COLUMN -->
      <section class="bg-white border border-slate-200 rounded-2xl shadow-sm p-5 flex flex-col gap-4">

        <h2 class="text-lg md:text-xl font-semibold text-slate-900">
          Fluency radar and personalized growth plan
        </h2>

        <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4">
          <canvas id="fluencyRadar"></canvas>
          <p class="text-[11px] text-slate-500 text-center mt-2">
            Each axis represents your accuracy in a domain.
          </p>
        </div>

        <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4 flex-1">
          <h3 class="font-semibold text-sm text-slate-900">Summary</h3>
          <p id="overallSummary" class="text-xs text-slate-700 mt-1">
            Answer some questions to start building your profile.
          </p>

          <div id="domainSummaries" class="mt-3 space-y-2"></div>
        </div>

      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-slate-200 bg-slate-50 py-3">
    <div class="max-w-6xl mx-auto px-4 text-xs text-slate-500">
      MedAI Fluency Practice Tool. Educational use only.
    </div>
  </footer>

  <!-- JAVASCRIPT -->
  <script>
    const DOMAIN_LABELS = [
      "Prompt mastery and conversation patterns",
      "Model fundamentals and limitations",
      "Practical use cases in education, research, and clinical work",
      "Critical evaluation, bias, and safety",
      "Workflow design and governance"
    ];

    let allQuestions = [];
    let questionsByDomain = {};
    let currentDomain = null;
    let currentIndex = 0;
    let answered = false;

    const stats = {};
    DOMAIN_LABELS.forEach(d => stats[d] = { correct: 0, total: 0 });

    let radarChart = null;

    const domainButtonsEl = document.getElementById("domainButtons");
    const questionStemEl = document.getElementById("questionStem");
    const questionDomainLabelEl = document.getElementById("questionDomainLabel");
    const questionCounterEl = document.getElementById("questionCounter");
    const optionsContainerEl = document.getElementById("optionsContainer");
    const feedbackEl = document.getElementById("feedbackArea");
    const prevBtn = document.getElementById("prevQuestionBtn");
    const nextBtn = document.getElementById("nextQuestionBtn");
    const overallSummaryEl = document.getElementById("overallSummary");
    const domainSummariesEl = document.getElementById("domainSummaries");

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function createDomainButtons() {
      DOMAIN_LABELS.forEach(domain => {
        const btn = document.createElement("button");
        btn.textContent = domain;
        btn.dataset.domain = domain;
        btn.className =
          "px-3 py-1.5 rounded-full border border-slate-300 bg-white text-slate-700 hover:bg-indigo-50 text-xs";
        btn.addEventListener("click", () => selectDomain(domain));
        domainButtonsEl.appendChild(btn);
      });
    }

    function highlightButtons() {
      const btns = domainButtonsEl.querySelectorAll("button");
      btns.forEach(btn => {
        if (btn.dataset.domain === currentDomain) {
          btn.classList.add("bg-indigo-600", "text-white", "border-indigo-500");
          btn.classList.remove("bg-white", "text-slate-700");
        } else {
          btn.classList.remove("bg-indigo-600", "text-white", "border-indigo-500");
          btn.classList.add("bg-white", "text-slate-700");
        }
      });
    }

    function selectDomain(domain) {
      currentDomain = domain;
      highlightButtons();

      const list = questionsByDomain[domain];
      questionsByDomain[domain] = shuffle(list);
      currentIndex = 0;
      answered = false;

      renderQuestion();
    }

    function getCurrent() {
      return questionsByDomain[currentDomain][currentIndex];
    }

    function renderQuestion() {
      const q = getCurrent();

      questionDomainLabelEl.textContent = currentDomain;
      questionCounterEl.textContent = `Question ${currentIndex + 1}`;
      questionStemEl.textContent = q.stem;
      feedbackEl.innerHTML = "";
      answered = false;

      optionsContainerEl.innerHTML = "";
      q.options.forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className =
          "w-full text-left px-3 py-2 border border-slate-200 rounded-xl bg-white text-xs hover:bg-slate-100";
        btn.innerHTML = `<span class='font-semibold mr-2'>${String.fromCharCode(65+idx)}.</span>${opt}`;
        btn.dataset.index = idx;

        btn.addEventListener("click", () => handleAnswer(idx));
        optionsContainerEl.appendChild(btn);
      });

      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = true;
    }

    function handleAnswer(selected) {
      if (answered) return;
      answered = true;

      const q = getCurrent();
      const correct = q.correct;

      stats[currentDomain].total += 1;

      const optBtns = optionsContainerEl.querySelectorAll("button");
      optBtns.forEach(btn => btn.disabled = true);

      if (selected === correct) {
        stats[currentDomain].correct += 1;
        feedbackEl.innerHTML =
          `<p class="text-emerald-700 font-medium">Correct! ${String.fromCharCode(65+correct)} is right.</p>`;
      } else {
        feedbackEl.innerHTML =
          `<p class="text-rose-700 font-medium">
            Not correct. Correct answer:
            <span class="font-bold text-red-700">
              ${String.fromCharCode(65+correct)}. ${q.options[correct]}
            </span>
          </p>`;
      }

      optBtns.forEach((btn, idx) => {
        if (idx === correct) {
          btn.classList.add("bg-emerald-50", "border-emerald-500");
        }
        if (idx === selected && idx !== correct) {
          btn.classList.add("bg-rose-50", "border-rose-500");
        }
      });

      nextBtn.disabled = false;
      updateChart();
      updateSummaries();
    }

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      const list = questionsByDomain[currentDomain];
      if (currentIndex < list.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        feedbackEl.innerHTML +=
          `<p class="text-[11px] text-slate-500 mt-2">
            End of this domain’s questions.
          </p>`;
        nextBtn.disabled = true;
      }
    });

    function initChart() {
      const ctx = document.getElementById("fluencyRadar");
      radarChart = new Chart(ctx, {
        type: "radar",
        data: {
          labels: DOMAIN_LABELS,
          datasets: [
            { data: [0,0,0,0,0], fill: true }
          ]
        },
        options: {
          scales: { r: { suggestedMin: 0, suggestedMax: 100 } },
          plugins: { legend: { display: false } }
        }
      });
    }

    function updateChart() {
      const values = DOMAIN_LABELS.map(d => {
        const s = stats[d];
        if (s.total === 0) return 0;
        return Math.round((s.correct / s.total) * 100);
      });
      radarChart.data.datasets[0].data = values;
      radarChart.update();
    }

    function updateSummaries() {
      let answeredCount = DOMAIN_LABELS.reduce((sum, d) => sum + stats[d].total, 0);
      if (answeredCount === 0) {
        overallSummaryEl.textContent = 
          "Answer a few questions to begin generating a personalized fluency profile.";
        domainSummariesEl.innerHTML = "";
        return;
      }

      const results = DOMAIN_LABELS.map(domain => {
        const s = stats[domain];
        return {
          domain,
          accuracy: s.total ? Math.round((s.correct / s.total) * 100) : 0,
          total: s.total
        };
      });

      const best = results.reduce((a,b) => b.accuracy > a.accuracy ? b : a);
      const avg = Math.round(
        results.reduce((sum,d)=>sum+d.accuracy,0) / results.length
      );

      overallSummaryEl.textContent =
        `Your strongest domain so far: ${best.domain} (${best.accuracy}%). 
        Your average accuracy across all domains is ${avg}%.`;

      domainSummariesEl.innerHTML = "";
      results.forEach(r => {
        let note = "";
        if (r.total < 3) {
          note = "Not enough questions yet. Try at least 3–5 items.";
        } else if (r.accuracy >= 80) {
          note = "Strength. You can use this domain for teaching or mentorship.";
        } else if (r.accuracy >= 50) {
          note = "Developing. You have a base understanding.";
        } else {
          note = "Growth priority. Review Lexicon terms and retry.";
        }

        const div = document.createElement("div");
        div.className = "bg-white border border-slate-200 rounded-xl p-3 text-xs";
        div.innerHTML = `
          <p class="font-semibold text-slate-900">${r.domain}</p>
          <p class="text-slate-700">
            Accuracy: <strong>${r.accuracy}%</strong> · 
            Questions answered: <strong>${r.total}</strong>
          </p>
          <p class="mt-1 text-slate-600">${note}</p>
        `;
        domainSummariesEl.appendChild(div);
      });
    }

    async function loadQuestions() {
      const response = await fetch("medai_questions.json");
      const data = await response.json();

      allQuestions = data;
      questionsByDomain = {};

      DOMAIN_LABELS.forEach(d => questionsByDomain[d] = []);

      data.forEach(q => {
        if (questionsByDomain[q.domain]) {
          questionsByDomain[q.domain].push(q);
        }
      });

      createDomainButtons();
      selectDomain(DOMAIN_LABELS[0]);
    }

    document.addEventListener("DOMContentLoaded", () => {
      initChart();
      loadQuestions();
    });
  </script>

</body>
</html>
